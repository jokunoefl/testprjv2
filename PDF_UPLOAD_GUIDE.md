# PDFファイル本番環境アップロードガイド

ローカルのPDFファイルを本番環境（Render）にアップロードする方法を説明します。

## 📁 利用可能なスクリプト

### 1. 基本アップロードスクリプト
```bash
python3 scripts/simple_upload.py
```
- **特徴**: シンプルで高速
- **メタデータ**: 基本的な情報のみ
- **用途**: テスト用、大量アップロード

### 2. メタデータ抽出アップロードスクリプト（推奨）
```bash
python3 scripts/upload_pdfs_with_metadata.py
```
- **特徴**: ファイル名から自動的にメタデータを抽出
- **メタデータ**: 学校名、科目、年度を自動判定
- **用途**: 本格的な運用

### 3. バッチ処理アップロードスクリプト
```bash
python3 scripts/upload_pdfs_to_production.py
```
- **特徴**: バッチ処理、重複チェック、詳細ログ
- **メタデータ**: 手動設定
- **用途**: 大量ファイルの安全なアップロード

## 🚀 推奨手順

### Step 1: 事前準備
```bash
# 仮想環境のアクティベート
source venv/bin/activate

# 必要なパッケージの確認
pip install requests
```

### Step 2: アップロード実行
```bash
# メタデータ抽出アップロード（推奨）
python3 scripts/upload_pdfs_with_metadata.py
```

### Step 3: 確認
- 本番環境のフロントエンドでPDFが表示されることを確認
- エラーが発生した場合はログを確認

## 📊 メタデータ抽出ルール

### 科目の自動判定
- `kokugo`, `ja` → 国語
- `math`, `sansu` → 算数
- `sci`, `rika` → 理科
- `social`, `syakai` → 社会

### 学校名の自動判定
- `waseda` → 早稲田中学校
- `junior` → ジュニア中学校
- `帰国生` → 帰国生対象校
- その他 → その他中学校

### 年度の自動抽出
- ファイル名から`20XX`形式の年度を抽出

## ⚠️ 注意事項

### ファイルサイズ制限
- Renderの制限: 100MB/ファイル
- 大きなファイルは分割を検討

### アップロード速度
- ネットワーク状況により時間がかかる場合があります
- 大量ファイルの場合はバッチ処理を推奨

### 重複チェック
- 既に存在するファイルは自動的にスキップされます
- ファイル名が同じ場合は上書きされません

## 🔧 トラブルシューティング

### よくある問題

1. **接続エラー**
   ```bash
   # 本番環境の状態確認
   curl -I https://testprjv2-backend.onrender.com/docs
   ```

2. **タイムアウトエラー**
   - 大きなファイルの場合はタイムアウト時間を延長
   - ネットワーク状況を確認

3. **認証エラー**
   - 本番環境のAPIキー設定を確認
   - 環境変数の設定を確認

### ログの確認
```bash
# アップロードログの確認
tail -f upload.log

# エラーファイルの確認
grep "❌" upload.log
```

## 📈 アップロード統計

### 成功時の出力例
```
=== PDFファイル本番環境アップロード（メタデータ付き）===
本番環境URL: https://testprjv2-backend.onrender.com
ローカルPDFディレクトリ: backend/uploaded_pdfs
見つかったPDFファイル数: 90
本番環境の既存PDF数: 5
アップロード対象ファイル数: 85

=== アップロード予定ファイル ===
1. 2023_kokugo1.pdf
   学校: その他中学校, 科目: 国語, 年度: 2023
2. 2023_math1.pdf
   学校: その他中学校, 科目: 算数, 年度: 2023
...

85個のPDFファイルをアップロードしますか？ (y/N): y

[1/85] 処理中...
アップロード中: 2023_kokugo1.pdf
  学校: その他中学校
  科目: 国語
  年度: 2023
  サイズ: 6.2MB
✅ 成功: 2023_kokugo1.pdf (ID: 123)

=== アップロード完了 ===
成功: 85個
エラー: 0個
合計: 85個
```

## 🎯 次のステップ

1. **アップロード完了後**
   - 本番環境のフロントエンドでPDF表示を確認
   - メタデータの正確性を確認

2. **データベースの同期**
   - ローカルと本番環境のデータベースを同期
   - 必要に応じてデータベースファイルをアップロード

3. **定期アップロード**
   - 新しいPDFファイルが追加された場合の定期アップロード
   - CI/CDパイプラインでの自動アップロード
